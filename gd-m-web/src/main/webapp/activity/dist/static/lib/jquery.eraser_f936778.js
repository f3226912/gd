!function(t){var e=t(window).width(),o=t(window).height(),a={init:function(n){return this.each(function(){var r=t(this),i=r.data("eraser");if(!i){var c=e,u=o,s=r.offset(),h=t("<canvas/>"),l=h.get(0),p=n&&n.size?n.size:40,f=n&&n.completeRatio?n.completeRatio:.7,m=n&&n.completeFunction?n.completeFunction:null,v=n&&n.beforeFunction?n.beforeFunction:null,d=[],g=Math.floor(c/p),b=g*Math.floor(u/p),w=b,X=l.getContext("2d");for(r.after(h),l.id=this.id,l.className=this.className,l.width=c,l.height=u,X.drawImage(this,0,0,c,u),r.remove(),X.globalCompositeOperation="destination-out",X.strokeStyle="rgba(255,0,0,255)",X.lineWidth=p,X.lineCap="round",h.bind("mousedown.eraser",a.mouseDown),h.bind("touchstart.eraser",a.touchStart),h.bind("touchmove.eraser",a.touchMove),h.bind("touchend.eraser",a.touchEnd);w--;)d.push(1);i={posX:s.left,posY:s.top,touchDown:!1,touchID:-999,touchX:0,touchY:0,ptouchX:0,ptouchY:0,canvas:h,ctx:X,w:c,h:u,source:this,size:p,parts:d,colParts:g,numParts:b,ratio:0,complete:!1,completeRatio:f,completeFunction:m,beforeFunction:v},h.data("eraser",i),null!=i.beforeFunction&&i.beforeFunction(),t(window).resize(function(){var t=h.offset();i.posX=t.left,i.posY=t.top})}})},touchStart:function(e){var o=t(this),n=o.data("eraser");if(!n.touchDown){var r=e.originalEvent.changedTouches[0],i=r.pageX-n.posX,c=r.pageY;a.evaluatePoint(n,i,c),n.touchDown=!0,n.touchID=r.identifier,n.touchX=i,n.touchY=c,e.preventDefault()}},touchMove:function(e){var o=t(this),n=o.data("eraser");if(n.touchDown)for(var r=e.originalEvent.changedTouches,i=r.length;i--;)if(r[i].identifier==n.touchID){var c=r[i].pageX-n.posX,u=r[i].pageY;a.evaluatePoint(n,c,u),n.ctx.beginPath(),n.ctx.moveTo(n.touchX,n.touchY),n.touchX=c,n.touchY=u,n.ctx.lineTo(n.touchX,n.touchY),n.ctx.stroke(),e.preventDefault();break}},touchEnd:function(e){var o=t(this),a=o.data("eraser");if(a.touchDown)for(var n=e.originalEvent.changedTouches,r=n.length;r--;)if(n[r].identifier==a.touchID){a.touchDown=!1,e.preventDefault();break}},evaluatePoint:function(t,e,o){var a=Math.floor(e/t.size)+Math.floor(o/t.size)*t.colParts;a>=0&&a<t.numParts&&(t.ratio+=t.parts[a],t.parts[a]=0,t.complete||t.ratio/t.numParts>=t.completeRatio&&(t.complete=!0,null!=t.completeFunction&&t.completeFunction()))},mouseDown:function(e){var o=t(this),n=o.data("eraser"),r=e.pageX-n.posX,i=e.pageY-n.posY;a.evaluatePoint(n,r,i),n.touchDown=!0,n.touchX=r,n.touchY=i,n.ctx.beginPath(),n.ctx.moveTo(n.touchX-1,n.touchY),n.ctx.lineTo(n.touchX,n.touchY),n.ctx.stroke(),o.bind("mousemove.eraser",a.mouseMove),t(document).bind("mouseup.eraser",n,a.mouseUp),e.preventDefault()},mouseMove:function(e){var o=t(this),n=o.data("eraser"),r=e.pageX-n.posX,i=e.pageY-n.posY;a.evaluatePoint(n,r,i),n.ctx.beginPath(),n.ctx.moveTo(n.touchX,n.touchY),n.touchX=r,n.touchY=i,n.ctx.lineTo(n.touchX,n.touchY),n.ctx.stroke(),e.preventDefault()},mouseUp:function(e){var o=e.data,a=o.canvas;o.touchDown=!1,a.unbind("mousemove.eraser"),t(document).unbind("mouseup.eraser"),e.preventDefault()},clear:function(){var e=t(this),o=e.data("eraser");if(o){o.ctx.clearRect(0,0,o.w,o.h);for(var a=o.numParts;a--;)o.parts[a]=0;o.ratio=o.numParts,o.complete=!0,null!=o.completeFunction&&o.completeFunction()}},size:function(e){var o=t(this),a=o.data("eraser");a&&e&&(a.size=e,a.ctx.lineWidth=e)},reset:function(){var e=t(this),o=e.data("eraser");if(o){o.ctx.globalCompositeOperation="source-over",o.ctx.drawImage(o.source,0,0),o.ctx.globalCompositeOperation="destination-out";for(var a=o.numParts;a--;)o.parts[a]=1;o.ratio=0,o.complete=!1}}};t.fn.eraser=function(e){return a[e]?a[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e?void t.error("Method "+e+" does not yet exist on jQuery.eraser"):a.init.apply(this,arguments)}}(jQuery);